// JSON data
var data = JSON.parse('{  "house": [ {   "id": 28960375,   "address": "34805 Rue Rachel, Pierrefonds-Roxboro (Montréal), Quebec, H8Y2C6",   "neighborhood": "Pierrefonds/East",   "bathroom": 2,   "bedroom": 4,   "space": 6068,   "price": 314500,   "detail": {  "description": "Lovely 3+1 bedroom Bungalow for sale within walking distance of the Sunnybrook train station, parks, schools, gym and much more. Close to highway 13, Bois-de-Liesse nature park and other services. Hardwood floors throughout the main floor, spacious finished basement with second kitchen, 4th bedroom and lots of storage space.No right side neighbors.",  "maintenanceFee": 0,  "amenities": [    "Highway",    "Park",    "Schools",    "Public Transit"  ],  "features": [    "Double width or more driveway",    "Paved driveway"  ],  "contact": {    "name": "George Lallis",    "company": "ROYAL LEPAGE ALLIANCE",    "address": "2 - 1631 rue de Salaberry, Montréal, QC, H3M1K3",    "phone": "514-745-4430",    "website": ""  }   } }, {   "id": 27652393,   "address": "1020 45e Avenue, Rivière-des-Prairies/Pointe-aux-Trembles (Montréal), Quebec, H1A3W4",   "neighborhood": "Pointe-aux-Trembles",   "bathroom": 2,   "bedroom": 4,   "space": 8099,   "price": 329000,   "detail": {  "description": "Dans un secteur très paisible avec un superbe grand terrain, voici une belle maison de 4 chambres, 2 salles de bains et sous-sol fini avec sortie extérieure arrière. Très bien entretenue, un seul propriétaire depuis le début. Venez la visiter, vous l aimerez!",  "maintenanceFee": 0,  "amenities": [    "Highway",    "Golf Course",    "Schools",    "Public Transit"  ],  "features": [    "Paved driveway",    "PVC window",    "Sliding windows"  ],  "contact": {    "name": "Lise Venne",    "company": "RE/MAX CITÉ INC.",    "address": "13150 Sherbrooke E., Pointe-aux-Trembles, QC, H1A4B1",    "phone": "514-644-0000",    "website": "remax-cite.com/"  }   } }  ],  "mobile": [ {   "id": 25716385,   "address": "3950 Boul. Sir-Wilfrid-Laurier, #205, Saint-Hubert (Longueuil), Quebec, J3Y5Y9",   "neighborhood": "Sir-Wilfrid-Laurier",   "bathroom": 0,   "bedroom": 0,   "space": 0,   "price": 37000,   "detail": {  "description": "Maison mobile en construction de 16 pieds x 70 pieds + annexe! Terrain en location. -Dépôt de 2000,00$ et l Annexe du Vendeur sont requis avec toute offre soumise.",  "maintenanceFee": 0,  "amenities": [    "Highway",    "Hospital",    "Park",    "Schools",    "Public Transit"  ],  "features": [    "Paved driveway"  ],  "contact": {    "name": "Lynda Laroche",    "company": "ROYAL LEPAGE TRADITION - Saint-Hubert",    "address": "202 - 3120 Boul. Moïse-Vincent, Saint-Hubert, QC, J3Z0C4",    "phone": "450-656-9000",    "website": "www.royallepagetradition.net/"  }   } }  ],  "condos": [    {      "id": 19831083,      "address": "5100 Rue Dudemaine, #409, Ahuntsic-Cartierville (Montréal), Quebec, H4J1N8",      "neighborhood": "Cartierville",      "bathroom": 1,      "bedroom": 1,      "space": 595,   "price": 87000,      "detail": {        "description": "Live in your own condo for the same price of the rent Condo fees include heating, hot water,maintenance and building insurance Near to Sacré-Coeur hospital the train and subway Bus at the door to metro Côte Vertu located 5 minutes to shopping center,school Condo presently rented $530.00/month Condo is not available for showing until 08 sept. 2016",        "maintenanceFee": 237,  "amenities": [          "Highway",          "CEGEP",          "Golf Course",          "Hospital",          "Park",          "Schools",          "Public Transit",          "University"        ],  "features": [    "Melamine cupboard",    "PVC window",    "Sliding windows"  ],        "contact": {          "name": "Ivka Raic",    "company": "EXCEL IMMOBILIER INC.",          "address": "1485 rue de Collège Saint-Laurent, QC, H4L2L8",          "phone": "514-747-1221",          "website": "www.excelimmobilier.ca/fr/"        }      }    }, {      "id": 22897239,      "address": "3040 Boul. Tessier, #173, Chomedey (Laval), Quebec, H7S2L9",      "neighborhood": "Domaine Renaud",      "bathroom": 1,      "bedroom": 1,      "space": 346.7,   "price": 85900,      "detail": {        "description": "Domaine Renaud, condo bien situé, secteur paisible et recherché. Tout est à proximité : Centre Laval, Carrefour Laval, commerces, restaurants, écoles, parcs. Accès facile aux autoroutes. À 6mn du métro Montmorency en auto. Ensoleillé et bien entretenu. Idéal pour propriétaire-occupant à petit budget ou investisseur. **loué à 575$ au 30 juin 2017**",        "maintenanceFee": 72,  "amenities": [          "Highway",          "CEGEP",          "Schools",          "Public Transit",          "University"        ],  "features": [    "Inground pool"  ],          "contact": {          "name": "Khadija Kebboua",    "company": "PROPRIO DIRECT",          "address": "200 - 3899 aut. des Laurentides, Laval, QC, H7L3H7",          "phone": "514-856-4444",          "website": "https://propriodirect.com/"        }      }    }, {   "id": 17260406,   "address": "4908 Rue Ste-Catherine E., #6, Mercier/Hochelaga-Maisonneuve (Montréal), Quebec, H1V1Z8",   "neighborhood": "Hochelaga-Maisonneuve",   "bathroom": 1,   "bedroom": 1,   "space": 222,   "price": 89000,   "detail": {  "description": "Petit condo au 2e étage,style LOFT,entièrement rénové et convertie en 2010,plafond de 8.3 pieds,plancher en lattes de merisier,céramique cuisine et salle de bains,fenêtre thermos à manivelle,porte d extérieur en acier vitrée balcon en fibre de verre,armoires cuisine-thermoplastique comptoir en céramique,eau chaude fournie par la copropriété,motivé",  "maintenanceFee": 180,  "amenities": [    "Highway",    "CEGEP",    "Hospital",    "Park",    "Schools",    "Public Transit"  ],  "features": [    "Aluminium window",    "PVC window",    "Crank windows"  ],  "contact": {    "name": "Eugen Butucariu",    "company": "RE/MAX ALLIANCE E.B.",    "address": "3299 Beaubien E., Montréal, QC, H1X1G4",    "phone": "514-374-4000",    "website": ""  }   } }  ]}');

$(document).ready(function(){
	// Parse house data
	var table = $(".house");
	for (var key in data.house) {
		table.append('<tr class="not-first layer-1" onclick="openDetail(\'house\', ' + data.house[key].id + ')">\
			<td><div class="layer-2">' + data.house[key].id + '</div></td>\
			<td><div class="layer-2">' + data.house[key].neighborhood + '</div></td>\
			<td><div class="layer-2">' + data.house[key].bedroom + '</div></td>\
			<td><div class="layer-2">' + data.house[key].bathroom + '</div></td>\
			<td><div class="layer-2">' + (data.house[key].space == 0 ? 'no information' : data.house[key].space + ' sqft.') + '</div></td>\
			<td><div class="layer-2">$' + data.house[key].price + '</div></td>\
        </tr>');
	}
	
	// Parse condo data
	var table = $(".condo");
	for (var key in data.condos) {
		table.append('<tr class="not-first layer-1" onclick="openDetail(\'condos\', ' + data.condos[key].id + ')">\
			<td><div class="layer-2">' + data.condos[key].id + '</div></td>\
			<td><div class="layer-2">' + data.condos[key].neighborhood + '</div></td>\
			<td><div class="layer-2">' + data.condos[key].bedroom + '</div></td>\
			<td><div class="layer-2">' + data.condos[key].bathroom + '</div></td>\
			<td><div class="layer-2">' + (data.condos[key].space == 0 ? 'no information' : data.condos[key].space + ' sqft.') + '</div></td>\
			<td><div class="layer-2">$' + data.condos[key].price + '</div></td>\
        </tr>');
	}
	
	// Parse mobile data
	var table = $(".mobile");
	for (var key in data.mobile) {
		table.append('<tr class="not-first layer-1" onclick="openDetail(\'mobile\', ' + data.mobile[key].id + ')">\
			<td><div class="layer-2">' + data.mobile[key].id + '</div></td>\
			<td><div class="layer-2">' + data.mobile[key].neighborhood + '</div></td>\
			<td><div class="layer-2">' + data.mobile[key].bedroom + '</div></td>\
			<td><div class="layer-2">' + data.mobile[key].bathroom + '</div></td>\
			<td><div class="layer-2">' + (data.mobile[key].space == 0 ? 'no information' : data.mobile[key].space + ' sqft.') + '</div></td>\
			<td><div class="layer-2">$' + data.mobile[key].price + '</div></td>\
        </tr>');
	}
});

// Detail div open and close

function openDetail(estateType, id) {
	var detailData;
	if (estateType == 'condos') {
		for (var key in data.condos) {
			if (data.condos[key].id == id) {
				detailData = data.condos[key];
				break;
			}
		}
	} else if (estateType == 'house') {
		for (var key in data.house) {
			if (data.house[key].id == id) {
				detailData = data.house[key];
				break;
			}
		}
	} else if (estateType == 'mobile') {
		for (var key in data.mobile) {
			if (data.mobile[key].id == id) {
				detailData = data.mobile[key];
				break;
			}
		}
	}
	
	/*
		Fill in data
	<div class="detailPhoto">
	<div class="detailId">
	<div class="detailAddress">
	<div class="detailNeighborhood">
	<div class="detailBath">
	<div class="detailBed">
	<div class="detailSpace">
	<div class="detailPrice">
	<div class="detailDescription">
	<div class="detailFee">
	<div class="detailAmenties">
	<div class="detailFeatures">
	<div class="detailContactName">
	<div class="detailContactCompany">
	<div class="detailContactAddress">
	<div class="detailContactPhone">
	<div class="detailContactWeb">
	 */
	$('.detailId').html(detailData.id);
	$('.detailAddress').html(detailData.address);
	$('.detailNeighborhood').html(detailData.neighborhood);
	$('.detailBath').html(detailData.bathroom);
	$('.detailBed').html(detailData.bedroom);
	$('.detailSpace').html(detailData.space + ' sqft.');
	$('.detailPrice').html('$' + detailData.price);
	$('.detailDescription').html(detailData.detail.description);
	$('.detailFee').html('$' + detailData.detail.maintenanceFee + '/month');
	$('.detailContactName').html(detailData.detail.contact.name);
	$('.detailContactCompany').html(detailData.detail.contact.company);
	$('.detailContactAddress').html(detailData.detail.contact.address);
	$('.detailContactPhone').html(detailData.detail.contact.phone);
	
	// Build website
	if (detailData.detail.contact.website != '') {
		var website;
		if (detailData.detail.contact.website.indexOf("http") >= 0) {
			website = detailData.detail.contact.website;
		} else {
			website = 'http://' + detailData.detail.contact.website;
		}
		$('.detailContactWeb').html('<a href="' + website + '">Click here to visit the website</a>');
	} else {
		$('.detailContactWeb').html('none');
	}
	// Build amenties
	var amenitiesList = '<ul>';
	for (var amenity in detailData.detail.amenities) {
		amenitiesList += '<li>' + detailData.detail.amenities[amenity] + '</li>';
	}
	amenitiesList += '</ul>';
	$('.detailAmenities').html(amenitiesList);
	
	// Build features
	var featuresList = '<ul>';
	for (var feature in detailData.detail.features) {
		featuresList += '<li>' + detailData.detail.features[feature] + '</li>';
	}
	featuresList += '</ul>';
	$('.detailFeatures').html(featuresList);
	
	// Turn on div
	$('.detailBg').css('opacity', '1');
	$('.detailDiv').css('opacity', '1');
	$('.detailCloseButton').css('opacity', '1');
	$('.detailBg').css('pointer-events', 'auto');
	$('.detailDiv').css('pointer-events', 'auto');
	$('.detailCloseButton').css('pointer-events', 'auto');
}

function closeDetail() {
	// Make div disappear
	$('.detailBg').css('opacity', '0');
	$('.detailDiv').css('opacity', '0');
	$('.detailCloseButton').css('opacity', '1');
	$('.detailBg').css('pointer-events', 'none');
	$('.detailDiv').css('pointer-events', 'none');
	$('.detailCloseButton').css('pointer-events', 'none');
}

// Auto close listener
$(window).resize(function() {
	closeDetail();
});

$(window).scroll(function() {
	closeDetail();
});

$(document).keyup(function(e) {
     if (e.keyCode == 27) { // escape key maps to keycode `27`
        closeDetail();
    }
});